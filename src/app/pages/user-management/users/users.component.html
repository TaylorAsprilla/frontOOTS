<!-- page title -->
<app-page-title [breadcrumbItems]="pageTitle" [title]="'navigation.userManagement' | transloco"></app-page-title>

<!-- Navigation Actions Bar -->
<div class="row mb-3">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">{{ 'app.actions' | transloco }}</h5>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary" (click)="navigateToCreate()">
              <i class="mdi mdi-account-plus me-1"></i>{{ 'user.create' | transloco }}
            </button>
            <button type="button" class="btn btn-outline-info" (click)="navigateToDetails()">
              <i class="mdi mdi-account-details me-1"></i>{{ 'user.details' | transloco }}
            </button>
            <button type="button" class="btn btn-outline-dark" (click)="navigateToSettings()">
              <i class="mdi mdi-cog me-1"></i>{{ 'app.settings' | transloco }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h4 class="header-title">{{ 'user.list' | transloco }}</h4>
            <p class="text-muted font-14">
              {{ 'navigation.userManagement' | transloco }}
              <span *ngIf="records.length > 0 && !loadingUsers" class="text-success ms-2">
                ({{ records.length }} {{ 'user.usersLoadedSuccess' | transloco }})
              </span>
              <span *ngIf="loadingUsers" class="text-info ms-2">
                <i class="mdi mdi-loading mdi-spin"></i> {{ 'user.loadingUsers' | transloco }}
              </span>
              <span *ngIf="errorLoadingUsers" class="text-danger ms-2">
                <i class="mdi mdi-alert-circle"></i> {{ 'states.backendError' | transloco }}
              </span>
            </p>
          </div>

          <div class="d-flex gap-2">
            <button
              type="button"
              class="btn btn-outline-secondary waves-effect waves-light"
              (click)="refreshUsers()"
              [disabled]="loadingUsers"
              title="Refresh users from backend"
            >
              <i class="mdi" [ngClass]="loadingUsers ? 'mdi-loading mdi-spin' : 'mdi-refresh'"></i>
              <span class="ms-1">{{ loadingUsers ? 'Loading...' : 'Refresh' }}</span>
            </button>

            <button type="button" class="btn btn-primary waves-effect waves-light" (click)="navigateToCreate()">
              <i class="mdi mdi-plus-circle me-1"></i> New User
            </button>
          </div>
        </div>

        <!-- end col-->

        <!-- table start -->
        <div *ngIf="loadingUsers" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading users...</span>
          </div>
          <p class="mt-3 text-muted">Loading users from backend...</p>
        </div>

        <div *ngIf="errorLoadingUsers && !loadingUsers" class="alert alert-warning" role="alert">
          <i class="mdi mdi-alert-circle me-2"></i>
          <strong>Backend Connection Error:</strong> Could not load users from the server.
          <button class="btn btn-sm btn-outline-primary ms-3" (click)="refreshUsers()">
            <i class="mdi mdi-refresh me-1"></i>Try Again
          </button>
        </div>

        <app-advanced-table
          *ngIf="!loadingUsers"
          [tableData]="records"
          [columns]="columns"
          [pagination]="true"
          [pageSizeOptions]="pageSizeOptions"
          [hasRowSelection]="true"
          [isSearchable]="true"
          (search)="searchData($event)"
          [isSortable]="true"
          (sort)="onSort($event)"
        >
        </app-advanced-table>
      </div>
      <!-- end card body-->
    </div>
    <!-- end card -->
  </div>
  <!-- end col-->
</div>
<!-- end row-->
