<!-- start page title -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box">
      <div class="page-title-right">
        <form class="d-flex align-items-center mb-3">
          <div class="input-group input-group-sm">
            <input type="text" name="datepicker" id="dash-datepicker" class="form-control border" [(ngModel)]="date"
              ngbDatepicker #datepicker="ngbDatepicker" (click)="datepicker.toggle()" autoClose="'outside'" />

            <span class="input-group-text bg-blue border-blue text-white">
              <i class="mdi mdi-calendar-range"></i>
            </span>
          </div>
          <a href="javascript: void(0);" class="btn btn-blue btn-sm ms-2">
            <i class="mdi mdi-autorenew"></i>
          </a>
          <a href="javascript: void(0);" class="btn btn-blue btn-sm ms-1">
            <i class="mdi mdi-filter-variant"></i>
          </a>
        </form>
      </div>
      <h4 class="page-title">{{ 'dashboard.home' | transloco }}</h4>
    </div>
  </div>
</div>
<!-- end page title -->

<div class="row">
  @if (statisticsCardData.length === 0) {
  <div class="col-12 text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'app.loading' | transloco }}</span>
    </div>
    <p class="mt-2 text-muted">{{ 'dashboard.loading' | transloco }}</p>
  </div>
  }
  @for (item of statisticsCardData; track item.id) {
  <div class="col-md-6 col-xl-3">
    <app-widget-statistics-card1 [statisticsCardData]="item"></app-widget-statistics-card1>
  </div>
  }
  <!-- end col-->
</div>
<!-- end row-->

<div class="row">
  <div class="col-lg-4">
    <div class="card">
      <div class="card-body">
        <div class="float-end" ngbDropdown>
          <a href="javascript:void(0);" class="arrow-none card-drop" ngbDropdownToggle>
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu-end" ngbDropdownMenu>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.salesReport' | transloco }}</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.exportReport' | transloco }}</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.profit' | transloco }}</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.action' | transloco }}</a>
          </div>
        </div>

        <h4 class="header-title mb-0">{{ 'dashboard.charts.participantRelation' | transloco }}</h4>

        <div class="widget-chart text-center" dir="ltr">
          <div id="total-revenue" class="mt-0">
            <apx-chart class="apex-charts" [series]="revenuChart.series!" [chart]="revenuChart.chart!"
              [plotOptions]="revenuChart.plotOptions!" [colors]="revenuChart.colors!"
              [labels]="revenuChart.labels!"></apx-chart>
          </div>


          <div class="row">
            <div class="col-6">
              <p class="text-muted mb-0">{{ 'dashboard.charts.participants' | transloco }}</p>
              <h3 class="mb-0">{{ totalParticipants }}</h3>
            </div>
            <div class="col-6">
              <p class="text-muted mb-0">{{ 'dashboard.charts.cases' | transloco }}</p>
              <h3 class="mb-0">{{ totalCases }}</h3>
            </div>
          </div>
          <div class="mt-2">
            <p class="text-muted mb-0">
              <small>
                <span>{{ 'dashboard.charts.average' | transloco }}:</span> {{ totalParticipants > 0 ? (totalCases /
                totalParticipants).toFixed(2) : '0' }} <span>{{ 'dashboard.charts.casesPerParticipant' | transloco
                  }}</span>
              </small>
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- end card -->
  </div>
  <!-- end col-->

  <div class="col-lg-8">
    <div class="card">
      <div class="card-body pb-2">
        <!-- Botones de filtro comentados por ahora -->
        <!-- <div class="float-end d-none d-md-inline-block">
        <div class="btn-group mb-2">
          <button type="button" class="btn btn-xs btn-light" i18n>
              Today
            </button>
          <button type="button" class="btn btn-xs btn-light" i18n>
              Weekly
            </button>
          <button type="button" class="btn btn-xs btn-secondary" i18n>
              Monthly
            </button>
        </div>
      </div> -->

        <h4 class="header-title mb-3">{{ 'dashboard.charts.casesPerMonth' | transloco }} ({{ currentYear }})</h4>

        <div dir="ltr">
          <div id="sales-analytics" class="mt-4">
            <apx-chart class="apex-charts" [series]="salesAnalyticsChart.series!" [chart]="salesAnalyticsChart.chart!"
              [plotOptions]="salesAnalyticsChart.plotOptions!" [dataLabels]="salesAnalyticsChart.dataLabels!"
              [yaxis]="salesAnalyticsChart.yaxis!" [legend]="salesAnalyticsChart.legend!"
              [grid]="salesAnalyticsChart.grid!" [fill]="salesAnalyticsChart.fill!"
              [colors]="salesAnalyticsChart.colors!" [labels]="salesAnalyticsChart.labels!"
              [xaxis]="salesAnalyticsChart.xaxis!" [stroke]="salesAnalyticsChart.stroke!"></apx-chart>
          </div>
        </div>
      </div>
    </div>
    <!-- end card -->
  </div>
  <!-- end col-->
</div>
<!-- end row -->

<div class="row">
  <div class="col-xl-6">
    <div class="card">
      <div class="card-body">
        <div class="float-end" ngbDropdown>
          <a href="javascript:void(0);" class="arrow-none card-drop" ngbDropdownToggle>
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu-end" ngbDropdownMenu>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem i18n>Edit Report</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem i18n>Export Report</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem i18n>Action</a>
          </div>
        </div>

        <h4 class="header-title mb-3">{{ 'dashboard.tables.recentParticipants' | transloco }}</h4>

        <div class="table-responsive">
          <table class="table table-borderless table-hover table-nowrap table-centered m-0">
            <thead class="table-light">
              <tr>
                <th colspan="2">{{ 'dashboard.tables.name' | transloco }}</th>
                <th>{{ 'dashboard.tables.document' | transloco }}</th>
                <th>{{ 'dashboard.tables.email' | transloco }}</th>
                <th>{{ 'dashboard.tables.date' | transloco }}</th>
                <th>{{ 'dashboard.tables.actions' | transloco }}</th>
              </tr>
            </thead>
            <tbody>
              @if (recentParticipants.length === 0) {
              <tr>
                <td colspan="6" class="text-center text-muted">
                  <p class="mt-3 mb-3">{{ 'dashboard.tables.noParticipants' | transloco }}</p>
                </td>
              </tr>
              }
              @for (participant of recentParticipants; track participant.id) {
              <tr (click)="viewParticipant(participant)" style="cursor: pointer;">
                <td style="width: 36px">
                  <div
                    class="avatar-sm bg-primary rounded-circle d-flex align-items-center justify-content-center text-white fw-bold">
                    {{ getInitials(participant.fullName || participant.firstName + ' ' + participant.firstLastName) }}
                  </div>
                </td>
                <td>
                  <h5 class="m-0 fw-normal">{{ participant.fullName || participant.firstName + ' ' +
                    participant.firstLastName }}</h5>
                  <p class="mb-0 text-muted">
                    <small>{{ participant.createdAt | date : 'MMMM - yyyy' }}</small>
                  </p>
                </td>
                <td>{{ participant.documentNumber }}</td>
                <td>{{ participant.email }}</td>
                <td>{{ participant.createdAt | date : 'dd/MM/yyyy' }}</td>
                <td (click)="$event.stopPropagation()">
                  <a [routerLink]="['/participants/detail', participant.id]" class="btn btn-xs btn-light"
                    title="Ver detalles">
                    <i class="mdi mdi-eye"></i>
                  </a>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- end col -->

  <div class="col-xl-6">
    <div class="card">
      <div class="card-body">
        <div class="float-end" ngbDropdown>
          <a href="javascript:void(0);" class="arrow-none card-drop" ngbDropdownToggle>
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu-end" ngbDropdownMenu>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.editReport' | transloco }}</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.exportReport' | transloco }}</a>
            <!-- item-->
            <a href="javascript:void(0);" ngbDropdownItem>{{ 'dashboard.action' | transloco }}</a>
          </div>
        </div>

        <h4 class="header-title mb-3">{{ 'dashboard.tables.caseHistory' | transloco }}</h4>

        <div class="table-responsive">
          <table class="table table-borderless table-nowrap table-hover table-centered m-0">
            <thead class="table-light">
              <tr>
                <th>{{ 'dashboard.tables.participant' | transloco }}</th>
                <th>{{ 'dashboard.tables.caseNumber' | transloco }}</th>
                <th>{{ 'dashboard.tables.date' | transloco }}</th>
                <th>{{ 'dashboard.tables.status' | transloco }}</th>
                <th>{{ 'dashboard.tables.actions' | transloco }}</th>
              </tr>
            </thead>
            <tbody>
              @if (recentCases.length === 0) {
              <tr>
                <td colspan="5" class="text-center text-muted">
                  <p class="mt-3 mb-3">{{ 'dashboard.tables.noCases' | transloco }}</p>
                </td>
              </tr>
              }
              @for (caseItem of recentCases; track caseItem.id) {
              <tr>
                <td>
                  <h5 class="m-0 fw-normal">{{ caseItem.participant.fullName }}</h5>
                  <p class="mb-0 text-muted">
                    <small>{{ caseItem.participant.documentNumber }}</small>
                  </p>
                </td>
                <td>{{ caseItem.caseNumber }}</td>
                <td>{{ caseItem.createdAt | date : 'MMM dd, y' }}</td>
                <td>
                  <span [class]="getCaseStatusClass(caseItem.status)">
                    {{ getCaseStatusLabel(caseItem.status) }}
                  </span>
                </td>
                <td>
                  <a [routerLink]="['/apps/cases', caseItem.id]" class="btn btn-xs btn-light" title="Ver detalles">
                    <i class="mdi mdi-eye"></i>
                  </a>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        <!-- end .table-responsive-->
      </div>
    </div>
    <!-- end card-->
  </div>
  <!-- end col -->
</div>
<!-- end row -->