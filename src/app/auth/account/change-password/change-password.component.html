<div class="account-pages mt-5 mb-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-5">
                <div class="card bg-pattern">
                    <div class="card-body p-4">
                        <!-- Header -->
                        <div class="text-center w-75 m-auto mb-4">
                            <div class="auth-logo">
                                <a [routerLink]="['/dashboard']" class="logo logo-dark text-center">
                                    <span class="logo-lg">
                                        <img src="assets/images/logos/logo-oots.png" alt="OOTS Colombia" width="150" />
                                    </span>
                                </a>
                            </div>
                            <h4 class="text-dark-50 text-center mt-3 mb-2">{{ 'auth.changePasswordTitle' | transloco }}
                            </h4>
                            <p class="text-muted mb-0">{{ 'auth.changePasswordSubtitle' | transloco }}</p>
                        </div>

                        <!-- Mensajes de Error -->
                        @if (errorMessage) {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="mdi mdi-alert-circle-outline me-2"></i>
                            {{ errorMessage }}
                            <button type="button" class="btn-close" (click)="errorMessage = null"></button>
                        </div>
                        }

                        <!-- Mensaje de Éxito -->
                        @if (successMessage) {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="mdi mdi-check-circle-outline me-2"></i>
                            {{ successMessage }}
                            <p class="mb-0 mt-2">
                                <small>{{ 'auth.successRedirect' | transloco }}</small>
                            </p>
                        </div>
                        }

                        <!-- Formulario -->
                        <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
                            <!-- Contraseña Actual -->
                            <div class="mb-3">
                                <label for="currentPassword" class="form-label">{{ 'auth.currentPasswordLabel' |
                                    transloco }} <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input [type]="showCurrentPassword ? 'text' : 'password'" class="form-control"
                                        id="currentPassword" formControlName="currentPassword"
                                        [placeholder]="'auth.currentPasswordPlaceholder' | transloco"
                                        [class.is-invalid]="submitted && f['currentPassword'].errors" />
                                    <button class="btn btn-outline-secondary" type="button"
                                        (click)="togglePasswordVisibility('current')">
                                        <i [class]="showCurrentPassword ? 'mdi mdi-eye-off' : 'mdi mdi-eye'"></i>
                                    </button>
                                </div>
                                @if (submitted && f['currentPassword'].errors) {
                                <div class="invalid-feedback d-block">
                                    @if (f['currentPassword'].errors['required']) {
                                    <span>{{ 'auth.currentPasswordRequired' | transloco }}</span>
                                    } @if (f['currentPassword'].errors['minlength']) {
                                    <span>{{ 'auth.passwordMinLength' | transloco: { length: 6 } }}</span>
                                    }
                                </div>
                                }
                            </div>

                            <!-- Nueva Contraseña -->
                            <div class="mb-3">
                                <label for="newPassword" class="form-label">{{ 'auth.newPasswordLabel' | transloco }}
                                    <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input [type]="showNewPassword ? 'text' : 'password'" class="form-control"
                                        id="newPassword" formControlName="newPassword"
                                        [placeholder]="'auth.newPasswordPlaceholder' | transloco"
                                        [class.is-invalid]="submitted && f['newPassword'].errors" />
                                    <button class="btn btn-outline-secondary" type="button"
                                        (click)="togglePasswordVisibility('new')">
                                        <i [class]="showNewPassword ? 'mdi mdi-eye-off' : 'mdi mdi-eye'"></i>
                                    </button>
                                </div>
                                @if (submitted && f['newPassword'].errors) {
                                <div class="invalid-feedback d-block">
                                    @if (f['newPassword'].errors['required']) {
                                    <span>{{ 'auth.newPasswordRequired' | transloco }}</span>
                                    } @if (f['newPassword'].errors['minlength']) {
                                    <span>{{ 'auth.passwordMinLength' | transloco: { length: 8 } }}</span>
                                    }
                                </div>
                                }
                                <small class="text-muted">{{ 'auth.passwordStrengthHint' | transloco }}</small>
                            </div>

                            <!-- Confirmar Contraseña -->
                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">{{ 'auth.confirmPasswordLabel' |
                                    transloco }} <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input [type]="showConfirmPassword ? 'text' : 'password'" class="form-control"
                                        id="confirmPassword" formControlName="confirmPassword"
                                        [placeholder]="'auth.confirmPasswordPlaceholder' | transloco"
                                        [class.is-invalid]="submitted && f['confirmPassword'].errors" />
                                    <button class="btn btn-outline-secondary" type="button"
                                        (click)="togglePasswordVisibility('confirm')">
                                        <i [class]="showConfirmPassword ? 'mdi mdi-eye-off' : 'mdi mdi-eye'"></i>
                                    </button>
                                </div>
                                @if (submitted && f['confirmPassword'].errors) {
                                <div class="invalid-feedback d-block">
                                    @if (f['confirmPassword'].errors['required']) {
                                    <span>{{ 'auth.confirmPasswordRequired' | transloco }}</span>
                                    } @if (f['confirmPassword'].errors['passwordMismatch']) {
                                    <span>{{ 'auth.passwordMismatch' | transloco }}</span>
                                    }
                                </div>
                                }
                            </div>

                            <!-- Botones -->
                            <div class="mb-3 text-center d-grid gap-2">
                                <button class="btn btn-primary" type="submit" [disabled]="loading || successMessage">
                                    @if (loading) {
                                    <span class="spinner-border spinner-border-sm me-2" role="status"
                                        aria-hidden="true"></span>
                                    {{ 'auth.changingPassword' | transloco }}
                                    } @else {
                                    <i class="mdi mdi-key-variant me-1"></i>
                                    {{ 'auth.changePassword' | transloco }}
                                    }
                                </button>

                                <button class="btn btn-secondary" type="button" (click)="onCancel()"
                                    [disabled]="loading">
                                    <i class="mdi mdi-arrow-left me-1"></i>
                                    {{ 'auth.cancel' | transloco }}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Info adicional -->
                <div class="row mt-3">
                    <div class="col-12 text-center">
                        <p class="text-muted">
                            <small>
                                <i class="mdi mdi-information-outline me-1"></i>
                                {{ 'auth.securityNote' | transloco }}
                            </small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>